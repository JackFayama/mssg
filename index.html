<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nova Prime Writers Chat</title>
  <style>
    :root {
      --theme-color: #0a5;
      --sender-bg: #dcf8c6;
      --receiver-bg: #fff;
      --sidebar-bg: #f8f9fa;
      --chat-bg: #ece5dd;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--chat-bg);
      display: flex;
      height: 100vh;
    }
    #sidebar {
      width: 300px;
      background-color: var(--sidebar-bg);
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }
    .contact {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      position: relative;
    }
    .contact:hover {
      background-color: #eaeaea;
    }
    .contact img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .contact-info {
      flex-grow: 1;
    }
    .contact-name {
      font-weight: bold;
    }
    .last-message {
      font-size: 12px;
      color: #666;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .unread {
      background: red;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
      font-size: 11px;
      position: absolute;
      right: 10px;
      top: 15px;
      display: none;
    }
    #chat-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #header {
      background-color: #f0f0f0;
      padding: 10px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #ccc;
      justify-content: space-between;
    }
    #header img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      margin-right: 10px;
    }
    #profileSettings {
      font-size: 14px;
      color: var(--theme-color);
      cursor: pointer;
    }
    #chat {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      display: flex;
      align-items: flex-end;
      margin: 8px 0;
      max-width: 80%;
    }
    .you {
      align-self: flex-end;
      flex-direction: row-reverse;
      text-align: right;
    }
    .friend {
      align-self: flex-start;
    }
    .msg-text {
      padding: 10px 14px;
      border-radius: 20px;
      background-color: var(--receiver-bg);
      position: relative;
    }
    .you .msg-text {
      background-color: var(--sender-bg);
    }
    .time {
      font-size: 10px;
      color: #555;
      margin-top: 2px;
    }
    .pfp {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin-right: 8px;
    }
    #inputArea {
      display: flex;
      padding: 10px;
      background-color: #f0f0f0;
      border-top: 1px solid #ccc;
    }
    #messageInput {
      flex-grow: 1;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 15px;
      margin-left: 10px;
      border: none;
      border-radius: 20px;
      background: var(--theme-color);
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #037c4b;
    }
    #newContactBtn {
      margin: 10px;
      background: #28a745;
    }
  </style>
</head>
<body>
<div id="sidebar">
  <button id="newContactBtn" onclick="addNewContact()">+ New Contact</button>
</div>
<div id="chat-container">
  <div id="header">
    <div id="contactHeader"></div>
    <div id="profileSettings" onclick="editProfile()">My Profile</div>
  </div>
  <div id="chat"></div>
  <div id="inputArea">
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>
<script>
  const kenyanNames = ["Achieng", "Wanjiku", "Njeri", "Atieno", "Nekesa", "Muthoni", "Akinyi", "Chebet", "Moraa", "Naliaka"];
  const contacts = kenyanNames.map((name, i) => ({ name, img: `p${i + 1}.jpg`, unread: 0, messages: [] }));
  let currentUser = null;
  const sidebar = document.getElementById('sidebar');
  const contactHeader = document.getElementById('contactHeader');
  const chat = document.getElementById('chat');
  contacts.forEach(contact => addContactToSidebar(contact));

  function addContactToSidebar(contact) {
    const div = document.createElement('div');
    div.className = 'contact';
    div.id = `contact-${contact.name}`;
    const lastMsg = contact.messages.length ? contact.messages.slice(-1)[0].text : '...';
    div.innerHTML = `
      <img src="${contact.img}">
      <div class="contact-info">
        <div class="contact-name">${contact.name}</div>
        <div class="last-message" id="last-${contact.name}">${lastMsg}</div>
      </div>
      <div class="unread" id="unread-${contact.name}" style="display:none;">0</div>
    `;
    div.onclick = () => selectUser(contact);
    sidebar.appendChild(div);
  }

  function updateUnread(contact) {
    const el = document.getElementById(`unread-${contact.name}`);
    if (contact.unread > 0) {
      el.textContent = contact.unread;
      el.style.display = 'inline-block';
    } else {
      el.style.display = 'none';
    }
  }

  function selectUser(user) {
    currentUser = user;
    contactHeader.innerHTML = `<img src="${user.img}"><b>${user.name}</b>`;
    user.unread = 0;
    updateUnread(user);
    loadChat();
  }

  function getTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  function sendMessage() {
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if (!currentUser || !text) return;
    const time = getTime();
    currentUser.messages.push({ sender: 'you', text, time });
    addMessage(text, 'you', time);
    document.getElementById(`last-${currentUser.name}`).textContent = text;
    input.value = '';
    saveChat();
  }

  function addMessage(text, sender, time) {
    const wrapper = document.createElement('div');
    wrapper.className = `message ${sender}`;
    if (sender === 'friend') {
      const img = document.createElement('img');
      img.src = currentUser.img;
      img.className = 'pfp';
      wrapper.appendChild(img);
    }
    const msg = document.createElement('div');
    msg.className = 'msg-text';
    msg.innerHTML = `${text}<div class="time">${time}</div>`;
    wrapper.appendChild(msg);
    chat.appendChild(wrapper);
    chat.scrollTop = chat.scrollHeight;
  }

  function autoReply() {
    const randomContact = contacts[Math.floor(Math.random() * contacts.length)];
    const messages = [
      "Nova Prime just made my week!",
      "Forever grateful to Nova Prime Writers",
      "I just landed my biggest client yet! Thanks Nova!",
      "These writers are angels",
      "Can’t believe how much I’ve grown with Nova Prime!",
      "Nova Prime changed my writing career",
      "Shout out to the best team ever",
      "Winning because of Nova!",
      "Thanks to Nova Prime, I’m now a top freelancer!"
    ];
    const msg = messages[Math.floor(Math.random() * messages.length)];
    const time = getTime();
    randomContact.messages.push({ sender: 'friend', text: msg, time });
    document.getElementById(`last-${randomContact.name}`).textContent = msg;
    if (currentUser !== randomContact) {
      randomContact.unread++;
      updateUnread(randomContact);
    } else {
      addMessage(msg, 'friend', time);
    }
    reorderContacts();
    saveChat();
  }

  function reorderContacts() {
    contacts.sort((a, b) => b.unread - a.unread);
    sidebar.innerHTML = '<button id="newContactBtn" onclick="addNewContact()">+ New Contact</button>';
    contacts.forEach(c => addContactToSidebar(c));
  }

  function saveChat() {
    contacts.forEach(c => {
      localStorage.setItem('chat_' + c.name, JSON.stringify(c.messages));
    });
  }

  function loadChat() {
    chat.innerHTML = '';
    if (!currentUser) return;
    const saved = localStorage.getItem('chat_' + currentUser.name);
    if (saved) currentUser.messages = JSON.parse(saved);
    currentUser.messages.forEach(m => addMessage(m.text, m.sender, m.time));
  }

  function editProfile() {
    alert("Profile editing coming soon!");
  }

  function addNewContact() {
    const name = prompt("Enter contact name:");
    if (!name) return;
    const img = prompt("Enter image filename (e.g., p11.jpg):") || 'default.jpg';
    const newContact = { name, img, unread: 0, messages: [] };
    contacts.push(newContact);
    addContactToSidebar(newContact);
  }

  setInterval(autoReply, Math.random() * 5000 + 5000);
</script>
</body>
</html>
